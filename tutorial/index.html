<h1 id="n-wa">Nüwa</h1>
<p>This is a archetype project (or seed project) for building up micro-service. Nüwa, also known as Nügua, is a goddess in ancient Chinese mythology best known for creating mankind and repairing the pillar of heaven. (from <a href="https://en.wikipedia.org/wiki/N%C3%BCwa">Wikipedia</a>)</p>
<h1 id="features">Features</h1>
<ul>
<li>BDD with cucumber-jvm</li>
<li>Stream module</li>
<li>Travis-CI &amp; Coveralls support</li>
</ul>
<h1 id="requirements">Requirements</h1>
<ul>
<li>Java 1.8.0_05 or above</li>
<li>Scala 2.11.6 or above</li>
<li>Activator 1.3.4 or above</li>
<li>sbt 0.13.8 or above</li>
</ul>
<h1 id="template-usage">Template Usage</h1>
<h2 id="1-pre-installation">1. Pre-installation</h2>
<h4 id="1-1-install-javase-http-www-oracle-com-technetwork-java-javase-downloads-index-html-java-1-8-0_05-or-above-">1.1 Install <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">JavaSE</a> (Java 1.8.0_05 or above)**</h4>
<h4 id="1-2-install-scala-http-www-scala-lang-org-download-scala-2-11-6-or-above-">1.2 Install <a href="http://www.scala-lang.org/download/">Scala</a> (Scala 2.11.6 or above)**</h4>
<h4 id="1-3-install-activator-https-www-typesafe-com-get-started-activator-1-3-4-or-above-">1.3 Install <a href="https://www.typesafe.com/get-started">Activator</a> (Activator 1.3.4 or above)**</h4>
<p>Both mini-package and full-package are OK.</p>
<h4 id="1-4-git-pull-repo">1.4 Git pull repo</h4>
<ul>
<li><p><em>Step 1</em>. pull repo</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>git&nbsp;clone&nbsp;</span><span class="markup underline link https hyperlink"><span>https://github.com/truman-misfit/nvwa.git</span></span></span></span></div></pre></li>
<li><p><em>Step 2</em>. activator run</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>cd&nbsp;nvwa</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>activator&nbsp;run</span></span></span></div></pre></li>
</ul>
<p>Or you can test cucumber by following the commands below:</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>activator&nbsp;cucumber</span></span></span></div></pre><h2 id="2-configuration">2. Configuration</h2>
<h4 id="2-1-stream">2.1 Stream</h4>
<p>Stream is a AWS Kinesis Publisher/Consumer module.</p>
<p>Using dependency injection, you can integrate Stream module into your self-customized services.</p>
<ul>
<li><p><em>Step 1</em>. add StreamPlugin in play.plugins
append the line below the play.plugins file:</p>
<pre class="editor-colors lang-scala"><div class="line"><span class="source scala"><span class="constant numeric scala"><span>1000</span></span><span class="keyword operator scala"><span>:</span></span><span>com.misfit.microservices.plugins.</span><span class="entity name class"><span>StreamPlugin</span></span></span></div></pre>
</li>
<li><p><em>Step 2</em>. define yourself StreamJob classes
For example:
One job for Logging</p>
</li>
</ul>
<pre class="editor-colors lang-scala"><div class="line"><span class="source scala"><span class="meta import scala"><span class="keyword other import scala"><span>import</span></span><span>&nbsp;</span><span class="variable package scala"><span>play.</span><span>api.</span></span><span>Logger</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source scala"><span class="meta import scala"><span class="keyword other import scala"><span>import</span></span><span>&nbsp;</span><span class="variable package scala"><span>com.</span><span>misfit.</span><span>microservices.</span><span>modules.</span></span><span>_</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;</span></span></div><div class="line"><span class="source scala"><span class="keyword declaration scala"><span>object</span></span><span>&nbsp;</span><span class="entity name class declaration"><span>PrintLogSampleJob</span></span><span>&nbsp;</span><span class="keyword declaration scala"><span>extends</span></span><span>&nbsp;</span><span class="entity other inherited-class scala"><span>StreamJob</span></span><span>&nbsp;</span><span class="meta bracket scala"><span>{</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier other"><span>override</span></span><span>&nbsp;</span><span class="keyword declaration scala"><span>def</span></span><span>&nbsp;</span><span class="entity name function declaration"><span>registerService</span></span><span>&nbsp;</span><span class="keyword operator comparison scala"><span>=</span></span><span>&nbsp;</span><span class="string quoted double scala"><span class="punctuation definition string begin scala"><span>&quot;</span></span><span>ms.backend.stream.log</span><span class="punctuation definition string end scala"><span>&quot;</span></span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier other"><span>override</span></span><span>&nbsp;</span><span class="keyword declaration scala"><span>def</span></span><span>&nbsp;</span><span class="entity name function declaration"><span>onEvent</span></span><span class="meta bracket scala"><span>(</span></span><span class="variable parameter scala"><span>event</span></span><span class="meta colon scala"><span>:</span></span><span>&nbsp;</span><span class="storage type scala"><span>String</span></span><span class="meta bracket scala"><span>)</span></span><span>&nbsp;</span><span class="keyword operator comparison scala"><span>=</span></span><span>&nbsp;</span><span class="meta bracket scala"><span>{</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword declaration stable scala"><span>val</span></span><span>&nbsp;</span><span class="entity name val declaration"><span>output</span></span><span>&nbsp;</span><span class="keyword operator comparison scala"><span>=</span></span><span>&nbsp;</span><span class="string quoted double scala"><span class="punctuation definition string begin scala"><span>&quot;</span></span><span>Received&nbsp;event&nbsp;from&nbsp;log&nbsp;stream:&nbsp;</span><span class="punctuation definition string end scala"><span>&quot;</span></span></span><span>&nbsp;</span><span class="keyword operator arithmetic scala"><span>+</span></span><span>&nbsp;event</span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="entity name class"><span>Logger</span></span><span>.info</span><span class="meta bracket scala"><span>(</span></span><span>output</span><span class="meta bracket scala"><span>)</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta bracket scala"><span>}</span></span></span></div><div class="line"><span class="source scala"><span class="meta bracket scala"><span>}</span></span></span></div></pre>
<p>Another job for mailing</p>
<pre class="editor-colors lang-scala"><div class="line"><span class="source scala"><span class="meta import scala"><span class="keyword other import scala"><span>import</span></span><span>&nbsp;</span><span class="variable package scala"><span>play.</span><span>api.</span></span><span>Logger</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source scala"><span class="meta import scala"><span class="keyword other import scala"><span>import</span></span><span>&nbsp;</span><span class="variable package scala"><span>com.</span><span>misfit.</span><span>microservices.</span><span>modules.</span></span><span>_</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;</span></span></div><div class="line"><span class="source scala"><span class="keyword declaration scala"><span>object</span></span><span>&nbsp;</span><span class="entity name class declaration"><span>PrintMailSampleJob</span></span><span>&nbsp;</span><span class="keyword declaration scala"><span>extends</span></span><span>&nbsp;</span><span class="entity other inherited-class scala"><span>StreamJob</span></span><span>&nbsp;</span><span class="meta bracket scala"><span>{</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier other"><span>override</span></span><span>&nbsp;</span><span class="keyword declaration scala"><span>def</span></span><span>&nbsp;</span><span class="entity name function declaration"><span>registerService</span></span><span>&nbsp;</span><span class="keyword operator comparison scala"><span>=</span></span><span>&nbsp;</span><span class="string quoted double scala"><span class="punctuation definition string begin scala"><span>&quot;</span></span><span>ms.backend.stream.mail</span><span class="punctuation definition string end scala"><span>&quot;</span></span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage modifier other"><span>override</span></span><span>&nbsp;</span><span class="keyword declaration scala"><span>def</span></span><span>&nbsp;</span><span class="entity name function declaration"><span>onEvent</span></span><span class="meta bracket scala"><span>(</span></span><span class="variable parameter scala"><span>event</span></span><span class="meta colon scala"><span>:</span></span><span>&nbsp;</span><span class="storage type scala"><span>String</span></span><span class="meta bracket scala"><span>)</span></span><span>&nbsp;</span><span class="keyword operator comparison scala"><span>=</span></span><span>&nbsp;</span><span class="meta bracket scala"><span>{</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword declaration stable scala"><span>val</span></span><span>&nbsp;</span><span class="entity name val declaration"><span>output</span></span><span>&nbsp;</span><span class="keyword operator comparison scala"><span>=</span></span><span>&nbsp;</span><span class="string quoted double scala"><span class="punctuation definition string begin scala"><span>&quot;</span></span><span>Received&nbsp;event&nbsp;from&nbsp;mail&nbsp;stream:&nbsp;</span><span class="punctuation definition string end scala"><span>&quot;</span></span></span><span>&nbsp;</span><span class="keyword operator arithmetic scala"><span>+</span></span><span>&nbsp;event</span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="entity name class"><span>Logger</span></span><span>.info</span><span class="meta bracket scala"><span>(</span></span><span>output</span><span class="meta bracket scala"><span>)</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta bracket scala"><span>}</span></span></span></div><div class="line"><span class="source scala"><span class="meta bracket scala"><span>}</span></span></span></div></pre>
<p>You can define your own consumer jobs with extending StreamJob trait and overriding the methods below:</p>
<pre class="editor-colors lang-scala"><div class="line"><span class="source scala"><span class="comment line double-slash scala"><span class="punctuation definition comment scala"><span>//</span></span><span>&nbsp;Your&nbsp;stream&nbsp;name.&nbsp;Each&nbsp;consumer&nbsp;should&nbsp;be&nbsp;assigned&nbsp;a&nbsp;stream</span></span></span></div><div class="line"><span class="source scala"><span class="storage modifier other"><span>override</span></span><span>&nbsp;</span><span class="keyword declaration scala"><span>def</span></span><span>&nbsp;</span><span class="entity name function declaration"><span>registerService</span></span><span>&nbsp;</span><span class="keyword operator comparison scala"><span>=</span></span><span>&nbsp;</span><span class="string quoted double scala"><span class="punctuation definition string begin scala"><span>&quot;</span></span><span class="punctuation definition string end scala"><span>&quot;</span></span></span></span></div><div class="line"><span class="source scala"><span class="comment line double-slash scala"><span class="punctuation definition comment scala"><span>//</span></span><span>&nbsp;your&nbsp;real&nbsp;job&nbsp;procedure&nbsp;is&nbsp;defined&nbsp;in&nbsp;this&nbsp;callback&nbsp;function</span></span></span></div><div class="line"><span class="source scala"><span class="storage modifier other"><span>override</span></span><span>&nbsp;</span><span class="keyword declaration scala"><span>def</span></span><span>&nbsp;</span><span class="entity name function declaration"><span>onEvent</span></span><span class="meta bracket scala"><span>(</span></span><span class="variable parameter scala"><span>event</span></span><span class="meta colon scala"><span>:</span></span><span>&nbsp;</span><span class="storage type scala"><span>String</span></span><span class="meta bracket scala"><span>)</span></span><span>&nbsp;</span><span class="keyword operator comparison scala"><span>=</span></span><span>&nbsp;</span><span class="meta bracket scala"><span>{</span><span>}</span></span></span></div></pre>
<ul>
<li><em>Step 3</em>. register your jobs in the application.conf file
Add the lines below into applicaion.conf:</li>
</ul>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>#&nbsp;Sharing&nbsp;config</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>play.modules.enabled&nbsp;+=&nbsp;&quot;com.misfit.microservices.modules.StreamPublisher&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>play.modules.enabled&nbsp;+=&nbsp;&quot;com.misfit.microservices.modules.StreamConsumer&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>module.ms.stream.region&nbsp;=&nbsp;&quot;us-east-1&quot;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>#&nbsp;Services&nbsp;registry&nbsp;config&nbsp;for&nbsp;frontend&nbsp;services</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>module.ms.publisher.enabled&nbsp;=&nbsp;true</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>module.ms.publisher.registry&nbsp;+=&nbsp;&quot;ms.backend.stream.mail&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>module.ms.publisher.registry&nbsp;+=&nbsp;&quot;ms.backend.stream.log&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>module.ms.publisher.type&nbsp;=&nbsp;&quot;kinesis&quot;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>#&nbsp;Services&nbsp;named&nbsp;config&nbsp;for&nbsp;backend&nbsp;services</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>module.ms.consumer.enabled&nbsp;=&nbsp;true</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>module.ms.consumer.app&nbsp;=&nbsp;&quot;ms.backend.stream.notify&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>module.ms.consumer.registry&nbsp;+=&nbsp;&quot;ms.backend.stream.mail&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>module.ms.consumer.registry&nbsp;+=&nbsp;&quot;ms.backend.stream.log&quot;</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>module.ms.consumer.type&nbsp;=&nbsp;&quot;kinesis&quot;</span></span></span></div></pre><ul>
<li><em>Step 4</em>. publish to a specific stream</li>
</ul>
<pre class="editor-colors lang-scala"><div class="line"><span class="source scala"><span class="keyword declaration scala"><span>class</span></span><span>&nbsp;</span><span class="entity name class declaration"><span>Application</span></span><span>&nbsp;</span><span class="keyword operator scala"><span>@</span></span><span class="entity name class"><span>Inject</span></span><span class="meta parentheses scala"><span class="meta bracket scala"><span>()</span></span></span><span class="meta bracket scala"><span>(</span></span><span class="variable parameter scala"><span>publisher</span></span><span class="meta colon scala"><span>:</span></span><span>&nbsp;</span><span class="entity name class"><span>StreamPublisherAbstract</span></span><span class="meta bracket scala"><span>)</span></span><span>&nbsp;</span><span class="keyword declaration scala"><span>extends</span></span><span>&nbsp;</span><span class="entity other inherited-class scala"><span>Controller</span></span><span>&nbsp;</span><span class="meta bracket scala"><span>{</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;</span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword declaration scala"><span>def</span></span><span>&nbsp;</span><span class="entity name function declaration"><span>pushToMailStream</span></span><span>&nbsp;</span><span class="keyword operator comparison scala"><span>=</span></span><span>&nbsp;</span><span class="entity name class"><span>Action</span></span><span>&nbsp;</span><span class="meta bracket scala"><span>{</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;publisher.publish</span><span class="meta bracket scala"><span>(</span></span><span class="string quoted double scala"><span class="punctuation definition string begin scala"><span>&quot;</span></span><span>ms.backend.stream.mail</span><span class="punctuation definition string end scala"><span>&quot;</span></span></span><span>,&nbsp;</span><span class="string quoted double scala"><span class="punctuation definition string begin scala"><span>&quot;</span></span><span>this&nbsp;is&nbsp;for&nbsp;mail&nbsp;stream.</span><span class="punctuation definition string end scala"><span>&quot;</span></span></span><span class="meta bracket scala"><span>)</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="entity name class"><span>Ok</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta bracket scala"><span>}</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;</span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword declaration scala"><span>def</span></span><span>&nbsp;</span><span class="entity name function declaration"><span>pushToLogStream</span></span><span>&nbsp;</span><span class="keyword operator comparison scala"><span>=</span></span><span>&nbsp;</span><span class="entity name class"><span>Action</span></span><span>&nbsp;</span><span class="meta bracket scala"><span>{</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;publisher.publish</span><span class="meta bracket scala"><span>(</span></span><span class="string quoted double scala"><span class="punctuation definition string begin scala"><span>&quot;</span></span><span>ms.backend.stream.log</span><span class="punctuation definition string end scala"><span>&quot;</span></span></span><span>,&nbsp;</span><span class="string quoted double scala"><span class="punctuation definition string begin scala"><span>&quot;</span></span><span>this&nbsp;is&nbsp;for&nbsp;log&nbsp;stream.</span><span class="punctuation definition string end scala"><span>&quot;</span></span></span><span class="meta bracket scala"><span>)</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="entity name class"><span>Ok</span></span></span></div><div class="line"><span class="source scala"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta bracket scala"><span>}</span></span></span></div><div class="line"><span class="source scala"><span class="meta bracket scala"><span>}</span></span></span></div></pre>
<h4 id="2-2-bdd">2.2 BDD</h4>
<p>BDD is implemented via cucumber-java. For details you can see the cucumber-jvm Github Page: <a href="https://github.com/cucumber/cucumber-jvm">cucumber/cucumber-jvm</a></p>
<p>You can self-define the cucumber default directory by modify the configs in build.sbt. Here is sample:</p>
<pre class="editor-colors lang-text"><div class="line"><span class="text plain"><span class="meta paragraph text"><span>//&nbsp;Play2-cucumber&nbsp;integration</span></span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>cucumberSettings</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>cucumberFeaturesLocation&nbsp;:=&nbsp;&quot;./test/BDD/features&quot;</span></span></span></div><div class="line"><span class="text plain"><span>&nbsp;</span></span></div><div class="line"><span class="text plain"><span class="meta paragraph text"><span>cucumberStepsBasePackage&nbsp;:=&nbsp;&quot;features.steps&quot;</span></span></span></div></pre><h1 id="future">Future</h1>
<ul>
<li>Local mode for Stream module(a internal message queue)</li>
<li>Kafka integration in Stream module</li>
<li>Cache module(a centralized cache system powered by Redis/ElastiCache)</li>
</ul>
<h1 id="author">Author</h1>
<p>truman@misfit.com</p>
